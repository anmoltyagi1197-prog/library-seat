<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Library Seat System</title>
<style>
body{font-family:Arial;text-align:center;background:#f2f2f2}
h2{margin:8px}
.controls{margin:10px}
button{padding:6px 12px;margin:4px}
.grid{
  display:grid;
  grid-template-columns: repeat(25, 32px);
  gap:6px;
  justify-content:center;
  margin-top:15px;
}
.seat{
  width:32px;height:32px;border-radius:4px;
  border:1px solid #333;cursor:pointer;
}
.vacant{background:white}
.paid{background:green}
.due{background:red}

#formBox{
 display:none;background:white;padding:10px;
 width:280px;margin:10px auto;border-radius:8px
}
input{width:95%;margin:4px;padding:5px}
</style>
</head>

<body>

<h2>Library Seat Management (350 Seats)</h2>

<div class="controls">
<button onclick="normalMode()">Seat Allotment Mode</button>
<button onclick="feesMode()">Fees Collection Mode</button>
<button onclick="exportData()">Export to Excel</button>
</div>

<div class="grid" id="seatGrid"></div>

<div id="formBox">
<h3>Member Details</h3>
<input id="name" placeholder="Name">
<input id="mobile" placeholder="Mobile">
<input id="address" placeholder="Address">
<input id="date" type="date">
<br>
<button onclick="saveMember()">Save</button>
<button onclick="markPaid()">Mark Fee Paid</button>
<button onclick="vacate()">Vacate Seat</button>
</div>

<script>
let seats = JSON.parse(localStorage.getItem("librarySeats")) || {};
let memberID = parseInt(localStorage.getItem("memberID")) || 1000;
let selectedSeat = null;
let mode="normal";

function saveStorage(){
 localStorage.setItem("librarySeats", JSON.stringify(seats));
 localStorage.setItem("memberID", memberID);
}

function createSeats(){
 let grid=document.getElementById("seatGrid");
 for(let i=1;i<=350;i++){
   let d=document.createElement("div");
   d.className="seat vacant";
   d.id="s"+i;
   d.onclick=()=>seatClick(i);
   grid.appendChild(d);
 }
}
createSeats();
updateColors();

function seatClick(num){
 selectedSeat=num;
 if(mode==="fees"){
   if(seats[num]){
     seats[num].status="paid";
     saveStorage();
     updateColors();
   }
   return;
 }
 document.getElementById("formBox").style.display="block";
 let data=seats[num];
 document.getElementById("name").value=data?data.name:"";
 document.getElementById("mobile").value=data?data.mobile:"";
 document.getElementById("address").value=data?data.address:"";
 document.getElementById("date").value=data?data.date:"";
}

function saveMember(){
 if(!seats[selectedSeat]) memberID++;
 seats[selectedSeat]={
   id:memberID,
   seat:selectedSeat,
   name:name.value,
   mobile:mobile.value,
   address:address.value,
   date:date.value,
   status:"due"
 };
 saveStorage();
 updateColors();
}

function markPaid(){
 if(seats[selectedSeat]){
   seats[selectedSeat].status="paid";
   saveStorage();
   updateColors();
 }
}

function vacate(){
 delete seats[selectedSeat];
 saveStorage();
 updateColors();
}

function updateColors(){
 for(let i=1;i<=350;i++){
   let seat=document.getElementById("s"+i);
   if(seats[i]){
     seat.className="seat "+(seats[i].status==="paid"?"paid":"due");
   }else{
     seat.className="seat vacant";
   }
 }
}

function normalMode(){
 mode="normal";
 alert("Seat Allotment Mode");
}

function feesMode(){
 mode="fees";
 alert("Fees Collection Mode: Click red seats to mark paid");
}

function exportData(){
 let csv="MemberID,Seat,Name,Mobile,Address,JoinDate,Status\n";
 for(let s in seats){
   let m=seats[s];
   csv+=`${m.id},${m.seat},${m.name},${m.mobile},${m.address},${m.date},${m.status}\n`;
 }
 let blob=new Blob([csv],{type:"text/csv"});
 let a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="library_data.csv";
 a.click();
}
</script>

</body>
</html>